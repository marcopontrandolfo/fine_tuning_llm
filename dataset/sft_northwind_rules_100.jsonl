{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Calcola il ricavo totale e il numero di ordini per categoria nell'anno 1997."},{"role":"assistant","content":"SELECT c.categoryId, c.categoryName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS totalRevenue, COUNT(DISTINCT so.orderId) AS orderCount FROM Category c JOIN Product p ON p.categoryId = c.categoryId JOIN OrderDetail od ON od.productId = p.productId JOIN SalesOrder so ON so.orderId = od.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY c.categoryId, c.categoryName;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Trova il 90° percentile del ritardo per corriere e area (shipRegion o shipCountry), escludendo corrieri con meno di 20 spedizioni."},{"role":"assistant","content":"WITH base AS ( SELECT s.shipperId, s.companyName, COALESCE(so.shipRegion, so.shipCountry) AS loc, DATEDIFF(so.shippedDate, so.requiredDate) AS delay_days, so.freight FROM SalesOrder so JOIN Shipper s ON s.shipperId = so.shipperid WHERE so.shippedDate IS NOT NULL ), ranked AS ( SELECT shipperId, companyName, loc, delay_days, ROW_NUMBER() OVER (PARTITION BY shipperId, loc ORDER BY delay_days) AS rn, COUNT(*) OVER (PARTITION BY shipperId, loc) AS cnt FROM base ), p90 AS ( SELECT shipperId, companyName, loc, AVG(delay_days) AS p90_delay FROM ranked WHERE rn >= CEIL(0.9*cnt) AND rn <= CEIL(0.9*cnt)+1 GROUP BY shipperId, companyName, loc ), agg AS ( SELECT shipperId, companyName, loc, COUNT(*) AS shipments, AVG(delay_days) AS avg_delay, SUM(delay_days*freight)/NULLIF(SUM(freight),0) AS avg_delay_wt FROM base GROUP BY shipperId, companyName, loc ) SELECT a.companyName, a.loc, a.shipments, a.avg_delay, a.avg_delay_wt, p.p90_delay FROM agg a LEFT JOIN p90 p ON p.shipperId = a.shipperId AND p.loc = a.loc WHERE a.shipments >= 20 ORDER BY a.companyName, a.loc;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Per ogni cliente, calcola ricavo totale 1997 e quota percentuale sul totale 1997."},{"role":"assistant","content":"WITH cust AS ( SELECT so.custId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY so.custId ), tot AS ( SELECT SUM(revenue) AS total FROM cust ) SELECT c.custId, cu.companyName, c.revenue, ROUND(100 * c.revenue / NULLIF(t.total,0), 2) AS pct FROM cust c JOIN Customer cu ON cu.custId = c.custId JOIN tot t ORDER BY c.revenue DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Per ogni corriere, quota di spedizioni in ritardo e ritardo medio pesato per costo."},{"role":"assistant","content":"WITH base AS ( SELECT s.shipperId, s.companyName, DATEDIFF(so.shippedDate, so.requiredDate) AS delay_days, so.freight FROM SalesOrder so JOIN Shipper s ON s.shipperId = so.shipperid WHERE so.shippedDate IS NOT NULL ), agg AS ( SELECT shipperId, companyName, COUNT(*) AS shipments, 100 * AVG(CASE WHEN delay_days > 0 THEN 1 ELSE 0 END) AS pct_late, SUM(delay_days*freight)/NULLIF(SUM(freight),0) AS avg_delay_wt FROM base GROUP BY shipperId, companyName ) SELECT companyName, shipments, pct_late, avg_delay_wt FROM agg ORDER BY pct_late DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Ricavo mensile per categoria nel 1997 (bucket YYYY-MM)."},{"role":"assistant","content":"SELECT DATE_FORMAT(so.orderDate,'%Y-%m') AS ym, c.categoryId, c.categoryName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Product p ON p.productId = od.productId JOIN Category c ON c.categoryId = p.categoryId WHERE YEAR(so.orderDate) = 1997 GROUP BY DATE_FORMAT(so.orderDate,'%Y-%m'), c.categoryId, c.categoryName ORDER BY ym, c.categoryId;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Clienti con più di 20 ordini e loro ricavo totale complessivo."},{"role":"assistant","content":"WITH cust_orders AS ( SELECT so.custId, COUNT(DISTINCT so.orderId) AS orders, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId GROUP BY so.custId ) SELECT cu.custId, cu.companyName, co.orders, co.revenue FROM cust_orders co JOIN Customer cu ON cu.custId = co.custId WHERE co.orders > 20 ORDER BY co.revenue DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Top 5 fornitori per ricavo totale."},{"role":"assistant","content":"SELECT s.supplierId, s.companyName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM Supplier s JOIN Product p ON p.supplierId = s.supplierId JOIN OrderDetail od ON od.productId = p.productId JOIN SalesOrder so ON so.orderId = od.orderId GROUP BY s.supplierId, s.companyName ORDER BY revenue DESC LIMIT 5;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Deviazione standard del valore ordine per prodotto nel 1997 (per ordine)."},{"role":"assistant","content":"WITH order_vals AS ( SELECT od.orderId, od.productId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS val FROM OrderDetail od JOIN SalesOrder so ON so.orderId = od.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY od.orderId, od.productId ), prod_stats AS ( SELECT productId, STDDEV_POP(val) AS stddev FROM order_vals GROUP BY productId ) SELECT p.productId, p.productName, ps.stddev FROM prod_stats ps JOIN Product p ON p.productId = ps.productId ORDER BY ps.stddev DESC LIMIT 10;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Media del ritardo spedizione per area (shipRegion o shipCountry)."},{"role":"assistant","content":"SELECT COALESCE(so.shipRegion, so.shipCountry) AS loc, AVG(DATEDIFF(so.shippedDate, so.requiredDate)) AS avgDelayDays FROM SalesOrder so WHERE so.shippedDate IS NOT NULL GROUP BY COALESCE(so.shipRegion, so.shipCountry) ORDER BY avgDelayDays DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Top 10 clienti per ricavo nel 1997, con media ritardo spedizioni."},{"role":"assistant","content":"WITH rev AS ( SELECT so.custId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY so.custId ), delays AS ( SELECT so.custId, AVG(DATEDIFF(so.shippedDate, so.requiredDate)) AS avg_delay FROM SalesOrder so WHERE YEAR(so.orderDate) = 1997 AND so.shippedDate IS NOT NULL GROUP BY so.custId ) SELECT cu.custId, cu.companyName, r.revenue, d.avg_delay FROM rev r JOIN Customer cu ON cu.custId = r.custId LEFT JOIN delays d ON d.custId = r.custId ORDER BY r.revenue DESC LIMIT 10;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Per ogni categoria, quota di ricavo per area nel 1997."},{"role":"assistant","content":"SELECT c.categoryId, c.categoryName, COALESCE(so.shipRegion, so.shipCountry) AS loc, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue, ROUND(100 * SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) / NULLIF(SUM(SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0)))) OVER (PARTITION BY c.categoryId),0), 2) AS pct FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Product p ON p.productId = od.productId JOIN Category c ON c.categoryId = p.categoryId WHERE YEAR(so.orderDate) = 1997 GROUP BY c.categoryId, c.categoryName, COALESCE(so.shipRegion, so.shipCountry) ORDER BY c.categoryId, pct DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Fornisci i 10 prodotti più venduti (ricavo) nell'ultimo anno disponibile."},{"role":"assistant","content":"WITH last_year AS ( SELECT MAX(YEAR(orderDate)) AS y FROM SalesOrder ), rev AS ( SELECT p.productId, p.productName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Product p ON p.productId = od.productId JOIN last_year ly WHERE YEAR(so.orderDate) = ly.y GROUP BY p.productId, p.productName ) SELECT productId, productName, revenue FROM rev ORDER BY revenue DESC LIMIT 10;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Tendenza mensile del numero di ordini per cliente nel 1997."},{"role":"assistant","content":"SELECT DATE_FORMAT(so.orderDate,'%Y-%m') AS ym, so.custId, cu.companyName, COUNT(DISTINCT so.orderId) AS orders FROM SalesOrder so JOIN Customer cu ON cu.custId = so.custId WHERE YEAR(so.orderDate) = 1997 GROUP BY DATE_FORMAT(so.orderDate,'%Y-%m'), so.custId, cu.companyName ORDER BY ym, so.custId;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Deviazione standard del ricavo per cliente nel 1997."},{"role":"assistant","content":"WITH order_rev AS ( SELECT so.orderId, so.custId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY so.orderId, so.custId ), stats AS ( SELECT custId, STDDEV_POP(revenue) AS stddev FROM order_rev GROUP BY custId ) SELECT cu.custId, cu.companyName, s.stddev FROM stats s JOIN Customer cu ON cu.custId = s.custId ORDER BY s.stddev DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Ricavo medio per ordine per cliente nel 1997."},{"role":"assistant","content":"WITH order_rev AS ( SELECT so.orderId, so.custId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY so.orderId, so.custId ) SELECT cu.custId, cu.companyName, AVG(orv.revenue) AS avgOrderValue FROM order_rev orv JOIN Customer cu ON cu.custId = orv.custId GROUP BY cu.custId, cu.companyName ORDER BY avgOrderValue DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Prodotti esauriti (unitsInStock = 0) con ricavo storico totale."},{"role":"assistant","content":"SELECT p.productId, p.productName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM Product p JOIN OrderDetail od ON od.productId = p.productId JOIN SalesOrder so ON so.orderId = od.orderId WHERE p.unitsInStock = 0 GROUP BY p.productId, p.productName ORDER BY revenue DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Clienti con nessun ordine nel 1997."},{"role":"assistant","content":"SELECT cu.custId, cu.companyName FROM Customer cu LEFT JOIN SalesOrder so ON so.custId = cu.custId AND YEAR(so.orderDate) = 1997 WHERE so.orderId IS NULL ORDER BY cu.companyName;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Ricavo per combinazione categoria x fornitore nel 1997."},{"role":"assistant","content":"SELECT c.categoryId, c.categoryName, s.supplierId, s.companyName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Product p ON p.productId = od.productId JOIN Category c ON c.categoryId = p.categoryId JOIN Supplier s ON s.supplierId = p.supplierId WHERE YEAR(so.orderDate) = 1997 GROUP BY c.categoryId, c.categoryName, s.supplierId, s.companyName ORDER BY revenue DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Top 3 prodotti per ricavo per categoria (1997)."},{"role":"assistant","content":"WITH prod_rev AS ( SELECT c.categoryId, c.categoryName, p.productId, p.productName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Product p ON p.productId = od.productId JOIN Category c ON c.categoryId = p.categoryId WHERE YEAR(so.orderDate) = 1997 GROUP BY c.categoryId, c.categoryName, p.productId, p.productName ), ranked AS ( SELECT pr.*, RANK() OVER (PARTITION BY categoryId ORDER BY revenue DESC) AS rnk FROM prod_rev pr ) SELECT categoryId, categoryName, productId, productName, revenue FROM ranked WHERE rnk <= 3 ORDER BY categoryId, revenue DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Ricavo mensile totale e scostamento rispetto al mese precedente (1997)."},{"role":"assistant","content":"WITH monthly AS ( SELECT DATE_FORMAT(so.orderDate,'%Y-%m') AS ym, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY DATE_FORMAT(so.orderDate,'%Y-%m') ) SELECT ym, revenue, revenue - LAG(revenue) OVER (ORDER BY ym) AS delta_prev FROM monthly ORDER BY ym;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"90° percentile del valore ordine per mese nel 1997."},{"role":"assistant","content":"WITH order_vals AS ( SELECT DATE_FORMAT(so.orderDate,'%Y-%m') AS ym, so.orderId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS orderValue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY DATE_FORMAT(so.orderDate,'%Y-%m'), so.orderId ), ranked AS ( SELECT ym, orderValue, ROW_NUMBER() OVER (PARTITION BY ym ORDER BY orderValue) AS rn, COUNT(*) OVER (PARTITION BY ym) AS cnt FROM order_vals ) SELECT ym, AVG(orderValue) AS p90 FROM ranked WHERE rn >= CEIL(0.9*cnt) AND rn <= CEIL(0.9*cnt)+1 GROUP BY ym ORDER BY ym;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Clienti con ricavo > 5% del totale 1997."},{"role":"assistant","content":"WITH cust AS ( SELECT so.custId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY so.custId ), tot AS ( SELECT SUM(revenue) AS total FROM cust ) SELECT cu.custId, cu.companyName, c.revenue, ROUND(100 * c.revenue / NULLIF(t.total,0), 2) AS pct FROM cust c JOIN Customer cu ON cu.custId = c.custId JOIN tot t WHERE c.revenue > 0.05 * t.total ORDER BY c.revenue DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Primi 10 clienti per numero di ordini nel 1997."},{"role":"assistant","content":"SELECT cu.custId, cu.companyName, COUNT(DISTINCT so.orderId) AS orders FROM SalesOrder so JOIN Customer cu ON cu.custId = so.custId WHERE YEAR(so.orderDate) = 1997 GROUP BY cu.custId, cu.companyName ORDER BY orders DESC LIMIT 10;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Prodotti con più alta quota di ricavo nel proprio paese/area di spedizione (1997)."},{"role":"assistant","content":"WITH base AS ( SELECT p.productId, p.productName, COALESCE(so.shipRegion, so.shipCountry) AS loc, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Product p ON p.productId = od.productId WHERE YEAR(so.orderDate) = 1997 GROUP BY p.productId, p.productName, COALESCE(so.shipRegion, so.shipCountry) ), shares AS ( SELECT productId, productName, loc, revenue, revenue / NULLIF(SUM(revenue) OVER (PARTITION BY productId),0) AS share FROM base ), ranked AS ( SELECT productId, productName, loc, share, RANK() OVER (PARTITION BY productId ORDER BY share DESC) AS rnk FROM shares ) SELECT productId, productName, loc, ROUND(100*share,2) AS pct FROM ranked WHERE rnk = 1 ORDER BY productId, loc;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Tasso di spedizioni in ritardo per paese/area nel 1997 e 1996, con variazione YoY."},{"role":"assistant","content":"WITH rates AS ( SELECT YEAR(so.orderDate) AS y, COALESCE(so.shipRegion, so.shipCountry) AS loc, AVG(CASE WHEN so.shippedDate > so.requiredDate THEN 1 ELSE 0 END) AS late_rate FROM SalesOrder so WHERE so.shippedDate IS NOT NULL AND YEAR(so.orderDate) IN (1996,1997) GROUP BY YEAR(so.orderDate), COALESCE(so.shipRegion, so.shipCountry) ) SELECT r97.loc, r97.late_rate AS rate_1997, r96.late_rate AS rate_1996, (r97.late_rate - r96.late_rate) AS delta FROM rates r97 JOIN rates r96 ON r96.loc = r97.loc AND r96.y = 1996 WHERE r97.y = 1997 ORDER BY delta DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Ricavo per dipendente per anno e ranking all'interno dell'anno."},{"role":"assistant","content":"WITH emp_year AS ( SELECT YEAR(so.orderDate) AS y, e.employeeId, e.firstname, e.lastname, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Employee e ON e.employeeId = so.employeeId GROUP BY YEAR(so.orderDate), e.employeeId, e.firstname, e.lastname ) SELECT y, employeeId, CONCAT(firstname,' ',lastname) AS employee, revenue, RANK() OVER (PARTITION BY y ORDER BY revenue DESC) AS rnk FROM emp_year ORDER BY y, rnk;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Sconto medio per fornitore nel 1997."},{"role":"assistant","content":"SELECT s.supplierId, s.companyName, AVG(COALESCE(od.discount,0)) AS avgDiscount FROM Supplier s JOIN Product p ON p.supplierId = s.supplierId JOIN OrderDetail od ON od.productId = p.productId JOIN SalesOrder so ON so.orderId = od.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY s.supplierId, s.companyName ORDER BY avgDiscount DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Clienti con acquisti ripetuti sullo stesso prodotto nel 1997 (almeno 2 ordini)."},{"role":"assistant","content":"WITH ops AS ( SELECT so.custId, od.productId, COUNT(DISTINCT so.orderId) AS ords FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY so.custId, od.productId ) SELECT cu.custId, cu.companyName, p.productId, p.productName, o.ords FROM ops o JOIN Customer cu ON cu.custId = o.custId JOIN Product p ON p.productId = o.productId WHERE o.ords >= 2 ORDER BY cu.custId, o.ords DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Categoria più redditizia per paese/area nel 1997."},{"role":"assistant","content":"WITH cat_loc AS ( SELECT COALESCE(so.shipRegion, so.shipCountry) AS loc, c.categoryId, c.categoryName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS rev FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Product p ON p.productId = od.productId JOIN Category c ON c.categoryId = p.categoryId WHERE YEAR(so.orderDate) = 1997 GROUP BY COALESCE(so.shipRegion, so.shipCountry), c.categoryId, c.categoryName ), ranked AS ( SELECT loc, categoryId, categoryName, rev, RANK() OVER (PARTITION BY loc ORDER BY rev DESC) AS rnk FROM cat_loc ) SELECT loc, categoryId, categoryName, rev FROM ranked WHERE rnk = 1 ORDER BY loc;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Valore mediano dell'ordine nel 1997."},{"role":"assistant","content":"WITH order_vals AS ( SELECT so.orderId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS val FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY so.orderId ), ranked AS ( SELECT val, ROW_NUMBER() OVER (ORDER BY val) AS rn, COUNT(*) OVER () AS cnt FROM order_vals ) SELECT AVG(val) AS medianOrderValue FROM ranked WHERE rn IN (FLOOR((cnt+1)/2), CEIL((cnt+1)/2));"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"90° percentile del ritardo per corriere (globale)."},{"role":"assistant","content":"WITH base AS ( SELECT s.shipperId, s.companyName, DATEDIFF(so.shippedDate, so.requiredDate) AS delay_days FROM SalesOrder so JOIN Shipper s ON s.shipperId = so.shipperid WHERE so.shippedDate IS NOT NULL ), ranked AS ( SELECT shipperId, companyName, delay_days, ROW_NUMBER() OVER (PARTITION BY shipperId ORDER BY delay_days) AS rn, COUNT(*) OVER (PARTITION BY shipperId) AS cnt FROM base ) SELECT shipperId, companyName, AVG(delay_days) AS p90_delay FROM ranked WHERE rn >= CEIL(0.9*cnt) AND rn <= CEIL(0.9*cnt)+1 GROUP BY shipperId, companyName ORDER BY p90_delay DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Numero di ordini per mese e regione (1997)."},{"role":"assistant","content":"SELECT DATE_FORMAT(so.orderDate,'%Y-%m') AS ym, r.regionId, r.regiondescription, COUNT(DISTINCT so.orderId) AS orders FROM SalesOrder so JOIN Employee e ON e.employeeId = so.employeeId JOIN EmployeeTerritory et ON et.employeeId = e.employeeId JOIN Territory t ON t.territoryId = et.territoryId JOIN Region r ON r.regionId = t.regionId WHERE YEAR(so.orderDate) = 1997 GROUP BY DATE_FORMAT(so.orderDate,'%Y-%m'), r.regionId, r.regiondescription ORDER BY ym, r.regionId;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Clienti con maggiore crescita di ordini dal 1996 al 1997."},{"role":"assistant","content":"WITH y AS ( SELECT so.custId, YEAR(so.orderDate) AS yr, COUNT(DISTINCT so.orderId) AS orders FROM SalesOrder so WHERE YEAR(so.orderDate) IN (1996,1997) GROUP BY so.custId, YEAR(so.orderDate) ), m AS ( SELECT y1997.custId, y1997.orders - COALESCE(y1996.orders,0) AS delta FROM (SELECT custId, orders FROM y WHERE yr=1997) y1997 LEFT JOIN (SELECT custId, orders FROM y WHERE yr=1996) y1996 ON y1996.custId = y1997.custId ) SELECT cu.custId, cu.companyName, m.delta FROM m JOIN Customer cu ON cu.custId = m.custId ORDER BY m.delta DESC LIMIT 10;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Totale freight per area (shipRegion/shipCountry) nel 1997."},{"role":"assistant","content":"SELECT COALESCE(so.shipRegion, so.shipCountry) AS loc, SUM(so.freight) AS totalFreight FROM SalesOrder so WHERE YEAR(so.orderDate) = 1997 GROUP BY COALESCE(so.shipRegion, so.shipCountry) ORDER BY totalFreight DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Per ogni cliente, quota per categoria del suo ricavo nel 1997."},{"role":"assistant","content":"WITH cust_cat AS ( SELECT so.custId, c.categoryId, c.categoryName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS rev FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Product p ON p.productId = od.productId JOIN Category c ON c.categoryId = p.categoryId WHERE YEAR(so.orderDate) = 1997 GROUP BY so.custId, c.categoryId, c.categoryName ), shares AS ( SELECT custId, categoryId, categoryName, rev, rev / NULLIF(SUM(rev) OVER (PARTITION BY custId),0) AS share FROM cust_cat ) SELECT cu.custId, cu.companyName, s.categoryId, s.categoryName, ROUND(100*s.share,2) AS pct FROM shares s JOIN Customer cu ON cu.custId = s.custId ORDER BY cu.custId, pct DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Ritardo medio di spedizione per territorio (1997)."},{"role":"assistant","content":"WITH base AS ( SELECT t.territoryId, t.territorydescription, DATEDIFF(so.shippedDate, so.requiredDate) AS delay_days FROM SalesOrder so JOIN Employee e ON e.employeeId = so.employeeId JOIN EmployeeTerritory et ON et.employeeId = e.employeeId JOIN Territory t ON t.territoryId = et.territoryId WHERE YEAR(so.orderDate) = 1997 AND so.shippedDate IS NOT NULL ) SELECT territoryId, territorydescription, AVG(delay_days) AS avgDelayDays FROM base GROUP BY territoryId, territorydescription ORDER BY avgDelayDays DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Matrice ricavo paese/area x categoria nel 1997."},{"role":"assistant","content":"SELECT COALESCE(so.shipRegion, so.shipCountry) AS loc, c.categoryId, c.categoryName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Product p ON p.productId = od.productId JOIN Category c ON c.categoryId = p.categoryId WHERE YEAR(so.orderDate) = 1997 GROUP BY COALESCE(so.shipRegion, so.shipCountry), c.categoryId, c.categoryName ORDER BY loc, c.categoryId;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Top 3 clienti per ricavo per categoria (1997)."},{"role":"assistant","content":"WITH cr AS ( SELECT c.categoryId, c.categoryName, so.custId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS rev FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Product p ON p.productId = od.productId JOIN Category c ON c.categoryId = p.categoryId WHERE YEAR(so.orderDate) = 1997 GROUP BY c.categoryId, c.categoryName, so.custId ), ranked AS ( SELECT cr.*, ROW_NUMBER() OVER (PARTITION BY categoryId ORDER BY rev DESC) AS rn FROM cr ) SELECT r.categoryId, r.categoryName, r.custId, cu.companyName, r.rev FROM ranked r JOIN Customer cu ON cu.custId = r.custId WHERE rn <= 3 ORDER BY r.categoryId, r.rev DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Crescita percentuale mese su mese del ricavo nel 1997."},{"role":"assistant","content":"WITH m AS ( SELECT DATE_FORMAT(so.orderDate,'%Y-%m') AS ym, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY DATE_FORMAT(so.orderDate,'%Y-%m') ) SELECT ym, ROUND(100 * (revenue - LAG(revenue) OVER (ORDER BY ym)) / NULLIF(LAG(revenue) OVER (ORDER BY ym),0), 2) AS mom_pct FROM m ORDER BY ym;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Tempo medio (giorni) tra orderDate e requiredDate per categoria (1997)."},{"role":"assistant","content":"SELECT c.categoryId, c.categoryName, AVG(DATEDIFF(so.requiredDate, so.orderDate)) AS avgLeadDays FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Product p ON p.productId = od.productId JOIN Category c ON c.categoryId = p.categoryId WHERE YEAR(so.orderDate) = 1997 GROUP BY c.categoryId, c.categoryName ORDER BY avgLeadDays DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Mediana del valore ordine per cliente nel 1997."},{"role":"assistant","content":"WITH orv AS ( SELECT so.orderId, so.custId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS val FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY so.orderId, so.custId ), rk AS ( SELECT custId, val, ROW_NUMBER() OVER (PARTITION BY custId ORDER BY val) AS rn, COUNT(*) OVER (PARTITION BY custId) AS cnt FROM orv ) SELECT cu.custId, cu.companyName, AVG(val) AS medianOrderValue FROM rk JOIN Customer cu ON cu.custId = rk.custId WHERE rn IN (FLOOR((cnt+1)/2), CEIL((cnt+1)/2)) GROUP BY cu.custId, cu.companyName ORDER BY medianOrderValue DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Ricavo per dipendente nel 1997 e quota percentuale sul totale 1997."},{"role":"assistant","content":"WITH emp_rev AS ( SELECT so.employeeId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS rev FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY so.employeeId ), tot AS ( SELECT SUM(rev) AS total FROM emp_rev ) SELECT e.employeeId, CONCAT(e.firstname,' ',e.lastname) AS employee, er.rev, ROUND(100 * er.rev / NULLIF(t.total,0), 2) AS pct FROM emp_rev er JOIN Employee e ON e.employeeId = er.employeeId JOIN tot t ORDER BY er.rev DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Ritardo medio e percentuale in ritardo per dipendente (1997)."},{"role":"assistant","content":"SELECT e.employeeId, CONCAT(e.firstname,' ',e.lastname) AS employee, AVG(DATEDIFF(so.shippedDate, so.requiredDate)) AS avgDelayDays, 100 * AVG(CASE WHEN so.shippedDate > so.requiredDate THEN 1 ELSE 0 END) AS pctLate FROM SalesOrder so JOIN Employee e ON e.employeeId = so.employeeId WHERE YEAR(so.orderDate) = 1997 AND so.shippedDate IS NOT NULL GROUP BY e.employeeId, e.firstname, e.lastname ORDER BY pctLate DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Coppie di prodotti frequenti (lift/confidence) nel 1997, support >= 6."},{"role":"assistant","content":"WITH Orders97 AS ( SELECT orderId FROM SalesOrder WHERE YEAR(orderDate) = 1997 ), OrderProducts AS ( SELECT od.orderId, od.productId FROM OrderDetail od JOIN Orders97 o ON o.orderId = od.orderId GROUP BY od.orderId, od.productId ), Pairs AS ( SELECT a.productId AS A, b.productId AS B, a.orderId FROM OrderProducts a JOIN OrderProducts b ON a.orderId = b.orderId AND a.productId < b.productId ), Support AS ( SELECT A, B, COUNT(DISTINCT orderId) AS supp FROM Pairs GROUP BY A, B HAVING supp >= 6 ), PS AS ( SELECT productId, COUNT(DISTINCT orderId) AS supp FROM OrderProducts GROUP BY productId ), T AS ( SELECT COUNT(DISTINCT orderId) AS tot FROM Orders97 ) SELECT s.A AS productA, s.B AS productB, s.supp, ROUND(s.supp / NULLIF(psA.supp,0),4) AS confidence, ROUND((s.supp / NULLIF(psA.supp,0)) / NULLIF(psB.supp / NULLIF(t.tot,0),0),4) AS lift FROM Support s JOIN PS psA ON psA.productId = s.A JOIN PS psB ON psB.productId = s.B JOIN T t ORDER BY lift DESC, s.supp DESC LIMIT 20;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Quota dei primi 10 clienti sul totale ricavi 1997."},{"role":"assistant","content":"WITH cust AS ( SELECT so.custId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS rev FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY so.custId ), top10 AS ( SELECT * FROM cust ORDER BY rev DESC LIMIT 10 ), totals AS ( SELECT SUM(rev) AS tot FROM cust ), t10 AS ( SELECT SUM(rev) AS top FROM top10 ) SELECT ROUND(100 * t10.top / NULLIF(totals.tot,0), 2) AS top10_share FROM t10, totals;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Percentuale spedizioni in ritardo per fornitore (via prodotti forniti), 1997."},{"role":"assistant","content":"SELECT s.supplierId, s.companyName, 100 * AVG(CASE WHEN so.shippedDate > so.requiredDate THEN 1 ELSE 0 END) AS pctLate FROM Supplier s JOIN Product p ON p.supplierId = s.supplierId JOIN OrderDetail od ON od.productId = p.productId JOIN SalesOrder so ON so.orderId = od.orderId WHERE YEAR(so.orderDate) = 1997 AND so.shippedDate IS NOT NULL GROUP BY s.supplierId, s.companyName ORDER BY pctLate DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Ricavo per dipendente per regione (1997) e ranking per regione."},{"role":"assistant","content":"WITH emp_rev AS ( SELECT r.regionId, r.regiondescription, e.employeeId, e.firstname, e.lastname, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Employee e ON e.employeeId = so.employeeId JOIN EmployeeTerritory et ON et.employeeId = e.employeeId JOIN Territory t ON t.territoryId = et.territoryId JOIN Region r ON r.regionId = t.regionId WHERE YEAR(so.orderDate) = 1997 GROUP BY r.regionId, r.regiondescription, e.employeeId, e.firstname, e.lastname ) SELECT regionId, regiondescription, employeeId, CONCAT(firstname,' ',lastname) AS employee, revenue, RANK() OVER (PARTITION BY regionId ORDER BY revenue DESC) AS rnk FROM emp_rev ORDER BY regionId, rnk;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Quota spedizioni per corriere all'interno di ciascuna categoria (1997)."},{"role":"assistant","content":"WITH cat_ship AS ( SELECT c.categoryId, c.categoryName, s.shipperId, s.companyName, COUNT(DISTINCT so.orderId) AS shipments FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Product p ON p.productId = od.productId JOIN Category c ON c.categoryId = p.categoryId JOIN Shipper s ON s.shipperId = so.shipperid WHERE YEAR(so.orderDate) = 1997 GROUP BY c.categoryId, c.categoryName, s.shipperId, s.companyName ) SELECT categoryId, categoryName, companyName, ROUND(100 * shipments / NULLIF(SUM(shipments) OVER (PARTITION BY categoryId),0), 2) AS pct FROM cat_ship ORDER BY categoryId, pct DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Top categoria per ciascuna regione (1997)."},{"role":"assistant","content":"WITH cat_reg AS ( SELECT r.regionId, r.regiondescription, c.categoryId, c.categoryName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Product p ON p.productId = od.productId JOIN Category c ON c.categoryId = p.categoryId JOIN Employee e ON e.employeeId = so.employeeId JOIN EmployeeTerritory et ON et.employeeId = e.employeeId JOIN Territory t ON t.territoryId = et.territoryId JOIN Region r ON r.regionId = t.regionId WHERE YEAR(so.orderDate) = 1997 GROUP BY r.regionId, r.regiondescription, c.categoryId, c.categoryName ), ranked AS ( SELECT regionId, regiondescription, categoryId, categoryName, revenue, RANK() OVER (PARTITION BY regionId ORDER BY revenue DESC) AS rnk FROM cat_reg ) SELECT regionId, regiondescription, categoryId, categoryName, revenue FROM ranked WHERE rnk = 1 ORDER BY regionId;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"RFM semplificato: recency (giorni dall'ultimo ordine), frequency (ordini), monetary (ricavo) per cliente al 1997-12-31."},{"role":"assistant","content":"WITH rev AS ( SELECT so.custId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS monetary FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY so.custId ), freq AS ( SELECT so.custId, COUNT(DISTINCT so.orderId) AS frequency FROM SalesOrder so WHERE YEAR(so.orderDate) = 1997 GROUP BY so.custId ), rec AS ( SELECT so.custId, DATEDIFF('1997-12-31', MAX(so.orderDate)) AS recency FROM SalesOrder so WHERE YEAR(so.orderDate) = 1997 GROUP BY so.custId ) SELECT cu.custId, cu.companyName, rec.recency, freq.frequency, rev.monetary FROM Customer cu LEFT JOIN rec ON rec.custId = cu.custId LEFT JOIN freq ON freq.custId = cu.custId LEFT JOIN rev ON rev.custId = cu.custId ORDER BY rev.monetary DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Ricavo giornaliero nel Q4 1997 con cumulato e media mobile a 3 giorni."},{"role":"assistant","content":"WITH daily AS ( SELECT DATE(so.orderDate) AS day, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS rev FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE so.orderDate >= '1997-10-01' AND so.orderDate <= '1997-12-31' GROUP BY DATE(so.orderDate) ) SELECT d.day, d.rev, SUM(d.rev) OVER (ORDER BY d.day) AS cum_rev, AVG(d.rev) OVER (ORDER BY d.day ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS ma3 FROM daily d ORDER BY d.day;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Ricavo mensile per categoria nel 1997 con cumulato per categoria e quota annuale entro categoria."},{"role":"assistant","content":"WITH cat_month AS ( SELECT DATE_FORMAT(so.orderDate,'%Y-%m') AS ym, c.categoryId, c.categoryName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS rev FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Product p ON p.productId = od.productId JOIN Category c ON c.categoryId = p.categoryId WHERE YEAR(so.orderDate) = 1997 GROUP BY DATE_FORMAT(so.orderDate,'%Y-%m'), c.categoryId, c.categoryName ) SELECT cm.ym, cm.categoryId, cm.categoryName, cm.rev, SUM(cm.rev) OVER (PARTITION BY cm.categoryId ORDER BY cm.ym) AS cum_rev_cat, ROUND(100 * cm.rev / NULLIF(SUM(cm.rev) OVER (PARTITION BY cm.categoryId), 0), 2) AS pct_year_cat FROM cat_month cm ORDER BY cm.categoryId, cm.ym;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Media mobile a 7 giorni del ritardo medio per corriere nel 1997 (per corriere)."},{"role":"assistant","content":"WITH ship_days AS ( SELECT s.shipperId, s.companyName, DATE(so.orderDate) AS day, AVG(DATEDIFF(so.shippedDate, so.requiredDate)) AS avg_delay FROM SalesOrder so JOIN Shipper s ON s.shipperId = so.shipperid WHERE YEAR(so.orderDate) = 1997 AND so.shippedDate IS NOT NULL GROUP BY s.shipperId, s.companyName, DATE(so.orderDate) ) SELECT sd.shipperId, sd.companyName, sd.day, sd.avg_delay, AVG(sd.avg_delay) OVER (PARTITION BY sd.shipperId ORDER BY sd.day ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS ma7_delay FROM ship_days sd ORDER BY sd.companyName, sd.day;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Volatilità del ricavo giornaliero nel 1997 come STDDEV_POP su finestra mobile 7 giorni."},{"role":"assistant","content":"WITH daily AS ( SELECT DATE(so.orderDate) AS day, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS rev FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY DATE(so.orderDate) ) SELECT d.day, d.rev, STDDEV_POP(d.rev) OVER (ORDER BY d.day ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS vol7 FROM daily d ORDER BY d.day;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Per ogni cliente, cumulato ordini mensili e media mobile a 3 mesi del ricavo nel 1997."},{"role":"assistant","content":"WITH cust_month AS ( SELECT DATE_FORMAT(so.orderDate,'%Y-%m') AS ym, so.custId, COUNT(DISTINCT so.orderId) AS orders, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY DATE_FORMAT(so.orderDate,'%Y-%m'), so.custId ) SELECT cm.ym, cm.custId, cm.orders, cm.revenue, SUM(cm.orders) OVER (PARTITION BY cm.custId ORDER BY cm.ym) AS cum_orders, AVG(cm.revenue) OVER (PARTITION BY cm.custId ORDER BY cm.ym ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS ma3_rev FROM cust_month cm ORDER BY cm.custId, cm.ym;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Ricavo totale e ordini per cliente nel 1997 qualificando tutte le colonne condivise tra tabelle."},{"role":"assistant","content":"SELECT cu.custId, cu.companyName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue, COUNT(DISTINCT so.orderId) AS orders FROM Customer cu JOIN SalesOrder so ON so.custId = cu.custId JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY cu.custId, cu.companyName ORDER BY revenue DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"assistant","content":"SELECT c.categoryId, c.categoryName, s.supplierId, s.companyName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM Category c JOIN Product p ON p.categoryId = c.categoryId JOIN Supplier s ON s.supplierId = p.supplierId JOIN OrderDetail od ON od.productId = p.productId JOIN SalesOrder so ON so.orderId = od.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY c.categoryId, c.categoryName, s.supplierId, s.companyName ORDER BY c.categoryId, revenue DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Per ogni corriere, ritardo medio e numero ordini per area (shipRegion/shipCountry) nel 1997 (colonne qualificate)."},{"role":"assistant","content":"SELECT s.shipperId, s.companyName, COALESCE(so.shipRegion, so.shipCountry) AS loc, AVG(DATEDIFF(so.shippedDate, so.requiredDate)) AS avg_delay, COUNT(DISTINCT so.orderId) AS orders FROM Shipper s JOIN SalesOrder so ON so.shipperid = s.shipperId WHERE YEAR(so.orderDate) = 1997 AND so.shippedDate IS NOT NULL GROUP BY s.shipperId, s.companyName, COALESCE(so.shipRegion, so.shipCountry) ORDER BY s.shipperId, avg_delay DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Top 5 prodotti per ricavo per regione nel 1997 (qualifica tutte le colonne comuni)."},{"role":"assistant","content":"WITH prod_loc AS ( SELECT p.productId, p.productName, COALESCE(so.shipRegion, so.shipCountry) AS loc, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM Product p JOIN OrderDetail od ON od.productId = p.productId JOIN SalesOrder so ON so.orderId = od.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY p.productId, p.productName, COALESCE(so.shipRegion, so.shipCountry) ) SELECT pl.productId, pl.productName, pl.loc, pl.revenue FROM prod_loc pl ORDER BY pl.revenue DESC LIMIT 5;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Quota di ricavo per categoria e città nel 1997 (qualifica colonne e usa NULLIF per divisioni)."},{"role":"assistant","content":"WITH cat_city AS ( SELECT c.categoryId, c.categoryName, so.shipCity, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM Category c JOIN Product p ON p.categoryId = c.categoryId JOIN OrderDetail od ON od.productId = p.productId JOIN SalesOrder so ON so.orderId = od.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY c.categoryId, c.categoryName, so.shipCity ), shares AS ( SELECT categoryId, categoryName, shipCity, revenue, revenue / NULLIF(SUM(revenue) OVER (PARTITION BY categoryId), 0) AS share FROM cat_city ) SELECT shares.categoryId, shares.categoryName, shares.shipCity, ROUND(100 * shares.share, 2) AS pct_share FROM shares ORDER BY shares.categoryId, pct_share DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Per ogni categoria, mostra il prodotto top per ricavo nel 1997 (evitando QUALIFY)."},{"role":"assistant","content":"WITH prod_cat AS ( SELECT c.categoryId, c.categoryName, p.productId, p.productName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM Category c JOIN Product p ON p.categoryId = c.categoryId JOIN OrderDetail od ON od.productId = p.productId JOIN SalesOrder so ON so.orderId = od.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY c.categoryId, c.categoryName, p.productId, p.productName ), ranked AS ( SELECT categoryId, categoryName, productId, productName, revenue, ROW_NUMBER() OVER (PARTITION BY categoryId ORDER BY revenue DESC) AS rn FROM prod_cat ) SELECT categoryId, categoryName, productId, productName, revenue FROM ranked WHERE rn = 1 ORDER BY categoryId, revenue DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Ricavo per categoria nel 1996 vs 1997 con full outer simulato (includi categorie presenti in un solo anno)."},{"role":"assistant","content":"WITH y96 AS ( SELECT c.categoryId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS rev96 FROM Category c JOIN Product p ON p.categoryId = c.categoryId JOIN OrderDetail od ON od.productId = p.productId JOIN SalesOrder so ON so.orderId = od.orderId WHERE YEAR(so.orderDate) = 1996 GROUP BY c.categoryId ), y97 AS ( SELECT c.categoryId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS rev97 FROM Category c JOIN Product p ON p.categoryId = c.categoryId JOIN OrderDetail od ON od.productId = p.productId JOIN SalesOrder so ON so.orderId = od.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY c.categoryId ), keys AS ( SELECT categoryId FROM y96 UNION SELECT categoryId FROM y97 ) SELECT k.categoryId, c.categoryName, y97.rev97, y96.rev96, (COALESCE(y97.rev97,0) - COALESCE(y96.rev96,0)) AS delta, CASE WHEN COALESCE(y96.rev96,0) > 0 THEN ROUND(100 * (COALESCE(y97.rev97,0) - y96.rev96) / y96.rev96, 2) ELSE NULL END AS pct FROM keys k LEFT JOIN y97 ON y97.categoryId = k.categoryId LEFT JOIN y96 ON y96.categoryId = k.categoryId JOIN Category c ON c.categoryId = k.categoryId ORDER BY delta DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Seconda pagina (righe 51-100) degli ordini 1997 per ricavo ordine (evita OFFSET/FETCH)."},{"role":"assistant","content":"WITH orders97 AS ( SELECT so.orderId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY so.orderId ) SELECT orderId, revenue FROM orders97 ORDER BY revenue DESC LIMIT 50 OFFSET 50;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"90° percentile del ritardo di spedizione per area (shipRegion o shipCountry) nel 1997 (senza PERCENTILE_CONT)."},{"role":"assistant","content":"WITH base AS ( SELECT COALESCE(so.shipRegion, so.shipCountry) AS loc, DATEDIFF(so.shippedDate, so.requiredDate) AS delay_days FROM SalesOrder so WHERE YEAR(so.orderDate) = 1997 AND so.shippedDate IS NOT NULL ), ranked AS ( SELECT loc, delay_days, ROW_NUMBER() OVER (PARTITION BY loc ORDER BY delay_days) AS rn, COUNT(*) OVER (PARTITION BY loc) AS cnt FROM base ) SELECT loc, AVG(delay_days) AS p90_delay FROM ranked WHERE rn BETWEEN CEIL(0.9*cnt) AND CEIL(0.9*cnt)+1 GROUP BY loc ORDER BY p90_delay DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Per ogni cliente, i 2 prodotti top per ricavo nel 1997 (evitare CROSS APPLY)."},{"role":"assistant","content":"WITH cust_prod AS ( SELECT so.custId, p.productId, p.productName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Product p ON p.productId = od.productId WHERE YEAR(so.orderDate) = 1997 GROUP BY so.custId, p.productId, p.productName ), ranked AS ( SELECT custId, productId, productName, revenue, ROW_NUMBER() OVER (PARTITION BY custId ORDER BY revenue DESC) AS rn FROM cust_prod ) SELECT cu.custId, cu.companyName, r.productId, r.productName, r.revenue FROM ranked r JOIN Customer cu ON cu.custId = r.custId WHERE r.rn <= 2 ORDER BY cu.custId, r.revenue DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Ricavo giornaliero nel Q4 1997 con cumulato, media mobile 7 giorni e flag HIGH_SPIKE (rev > 1.8*ma7). Usa più CTE ma una sola SELECT finale."},{"role":"assistant","content":"WITH daily AS ( SELECT DATE(so.orderDate) AS day, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS rev FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE so.orderDate >= '1997-10-01' AND so.orderDate <= '1997-12-31' GROUP BY DATE(so.orderDate) ), cum AS ( SELECT d.day, d.rev, SUM(d.rev) OVER (ORDER BY d.day) AS cum_rev FROM daily d ), ma7 AS ( SELECT d.day, AVG(d.rev) OVER (ORDER BY d.day ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS ma7 FROM daily d ), joined AS ( SELECT c.day, c.rev, c.cum_rev, m.ma7, CASE WHEN c.rev > 1.8 * m.ma7 THEN 'HIGH_SPIKE' ELSE NULL END AS spike FROM cum c JOIN ma7 m ON m.day = c.day ) SELECT j.day, j.rev, j.cum_rev, j.ma7, j.spike FROM joined j ORDER BY j.day;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Profilo cliente: ordini totali, ricavo totale, ritardo medio spedizioni e quota % sul totale ricavi, senza limitare l'anno. Usa più CTE e una SELECT finale."},{"role":"assistant","content":"WITH cust_rev AS ( SELECT so.custId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId GROUP BY so.custId ), cust_orders AS ( SELECT so.custId, COUNT(DISTINCT so.orderId) AS orders FROM SalesOrder so GROUP BY so.custId ), cust_delay AS ( SELECT so.custId, AVG(DATEDIFF(so.shippedDate, so.requiredDate)) AS avg_delay FROM SalesOrder so WHERE so.shippedDate IS NOT NULL GROUP BY so.custId ), tot AS ( SELECT SUM(revenue) AS total_rev FROM cust_rev ) SELECT cu.custId, cu.companyName, co.orders, cr.revenue, cd.avg_delay, ROUND(100 * cr.revenue / NULLIF(t.total_rev,0), 2) AS pct_total FROM Customer cu LEFT JOIN cust_rev cr ON cr.custId = cu.custId LEFT JOIN cust_orders co ON co.custId = cu.custId LEFT JOIN cust_delay cd ON cd.custId = cu.custId JOIN tot t ORDER BY cr.revenue DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Per categoria: top 3 prodotti per quota di ricavo, con ricavo prodotto, totale categoria e quota %. Usa CTE multiple e una SELECT finale."},{"role":"assistant","content":"WITH prod_cat AS ( SELECT c.categoryId, c.categoryName, p.productId, p.productName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS rev FROM Category c JOIN Product p ON p.categoryId = c.categoryId JOIN OrderDetail od ON od.productId = p.productId JOIN SalesOrder so ON so.orderId = od.orderId GROUP BY c.categoryId, c.categoryName, p.productId, p.productName ), totals AS ( SELECT categoryId, SUM(rev) AS tot_rev FROM prod_cat GROUP BY categoryId ), shares AS ( SELECT pc.categoryId, pc.categoryName, pc.productId, pc.productName, pc.rev, pc.rev / NULLIF(t.tot_rev,0) AS share FROM prod_cat pc JOIN totals t ON t.categoryId = pc.categoryId ), ranked AS ( SELECT categoryId, categoryName, productId, productName, rev, share, ROW_NUMBER() OVER (PARTITION BY categoryId ORDER BY share DESC) AS rn FROM shares ) SELECT categoryId, categoryName, productId, productName, rev, ROUND(100*share,2) AS pct_share FROM ranked WHERE rn <= 3 ORDER BY categoryId, pct_share DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Prestazioni spedizione: per corriere, spedizioni totali, % in ritardo, ritardo medio pesato per freight, e rank globale su ritardo medio. Usa CTE multiple e SELECT finale."},{"role":"assistant","content":"WITH base AS ( SELECT s.shipperId, s.companyName, DATEDIFF(so.shippedDate, so.requiredDate) AS delay_days, CASE WHEN DATEDIFF(so.shippedDate, so.requiredDate) > 0 THEN 1 ELSE 0 END AS is_late, so.freight FROM SalesOrder so JOIN Shipper s ON s.shipperId = so.shipperid WHERE so.shippedDate IS NOT NULL ), agg AS ( SELECT shipperId, companyName, COUNT(*) AS shipments, 100 * AVG(is_late) AS pct_late, SUM(delay_days * freight)/NULLIF(SUM(freight),0) AS avg_delay_wt FROM base GROUP BY shipperId, companyName ), ranked AS ( SELECT shipperId, companyName, shipments, pct_late, avg_delay_wt, RANK() OVER (ORDER BY avg_delay_wt DESC) AS rnk FROM agg ) SELECT shipperId, companyName, shipments, pct_late, avg_delay_wt, rnk FROM ranked ORDER BY rnk;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Ricavo YoY per regione con variazione assoluta e %, includendo aree presenti solo in un anno (simula full‑outer con unione chiavi). Usa CTE multiple e SELECT finale."},{"role":"assistant","content":"WITH rev AS ( SELECT YEAR(so.orderDate) AS y, COALESCE(so.shipRegion, so.shipCountry) AS loc, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId GROUP BY YEAR(so.orderDate), COALESCE(so.shipRegion, so.shipCountry) ), y_prev AS ( SELECT y+1 AS y, loc, revenue AS rev_prev FROM rev ), y_curr AS ( SELECT y AS y, loc, revenue AS rev_curr FROM rev ), keys AS ( SELECT y, loc FROM y_curr UNION SELECT y, loc FROM y_prev ), paired AS ( SELECT k.y, k.loc, p.rev_prev, c.rev_curr FROM keys k LEFT JOIN y_prev p ON p.y = k.y AND p.loc = k.loc LEFT JOIN y_curr c ON c.y = k.y AND c.loc = k.loc ) SELECT y AS year, loc, rev_prev, rev_curr, (COALESCE(rev_curr,0) - COALESCE(rev_prev,0)) AS delta, CASE WHEN COALESCE(rev_prev,0) > 0 THEN ROUND(100 * (COALESCE(rev_curr,0) - rev_prev) / rev_prev, 2) ELSE NULL END AS pct FROM paired ORDER BY year DESC, delta DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"assistant","content":"SELECT c.categoryId, c.categoryName, SUM(q.rev) AS revenue FROM Category c JOIN ( SELECT p.categoryId AS categoryId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS rev FROM Product p JOIN OrderDetail od ON od.productId = p.productId JOIN SalesOrder so ON so.orderId = od.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY p.categoryId ) AS q ON q.categoryId = c.categoryId GROUP BY c.categoryId, c.categoryName ORDER BY revenue DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Top 5 clienti per ricavo 1997 usando una subquery aggregata con alias e join a Customer."},{"role":"assistant","content":"SELECT cu.custId, cu.companyName, agg.revenue FROM Customer cu JOIN ( SELECT so.custId AS custId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY so.custId ) AS agg ON agg.custId = cu.custId ORDER BY agg.revenue DESC LIMIT 5;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Per ogni corriere, ordini totali e ricavo totale nel 1997, usando due subquery derivate con alias."},{"role":"assistant","content":"SELECT s.shipperId, s.companyName, o.orders, r.revenue FROM Shipper s JOIN ( SELECT so.shipperid AS shipperId, COUNT(DISTINCT so.orderId) AS orders FROM SalesOrder so WHERE YEAR(so.orderDate) = 1997 GROUP BY so.shipperid ) AS o ON o.shipperId = s.shipperId JOIN ( SELECT so.shipperid AS shipperId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY so.shipperid ) AS r ON r.shipperId = s.shipperId ORDER BY r.revenue DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Quota di ricavo per supplier nel 1997 usando subquery derivata con alias e finestra per totale per supplier."},{"role":"assistant","content":"WITH sup_prod AS ( SELECT s.supplierId, s.companyName, p.productId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM Supplier s JOIN Product p ON p.supplierId = s.supplierId JOIN OrderDetail od ON od.productId = p.productId JOIN SalesOrder so ON so.orderId = od.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY s.supplierId, s.companyName, p.productId ), shares AS ( SELECT sp.supplierId, sp.companyName, sp.productId, sp.revenue, sp.revenue / NULLIF(SUM(sp.revenue) OVER (PARTITION BY sp.supplierId), 0) AS share FROM sup_prod sp ) SELECT sh.supplierId, sh.companyName, sh.productId, ROUND(100*sh.share,2) AS pct_share FROM shares sh ORDER BY sh.supplierId, pct_share DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Ricavo per regione nel 1997 con tabella derivata che calcola ricavo per ordine (alias esplicito)."},{"role":"assistant","content":"SELECT COALESCE(so.shipRegion, so.shipCountry) AS loc, SUM(q.rev) AS revenue FROM SalesOrder so JOIN ( SELECT od.orderId AS orderId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS rev FROM OrderDetail od GROUP BY od.orderId ) AS q ON q.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY COALESCE(so.shipRegion, so.shipCountry) ORDER BY revenue DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Quota di ricavo per categoria nel 1997 (percentuale sul totale 1997)."},{"role":"assistant","content":"WITH cat AS ( SELECT c.categoryId, c.categoryName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Product p ON p.productId = od.productId JOIN Category c ON c.categoryId = p.categoryId WHERE YEAR(so.orderDate) = 1997 GROUP BY c.categoryId, c.categoryName ), tot AS ( SELECT SUM(revenue) AS total FROM cat ) SELECT cat.categoryId, cat.categoryName, cat.revenue, ROUND(100 * cat.revenue / NULLIF(tot.total, 0), 2) AS pct FROM cat JOIN tot ORDER BY pct DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Ritardo medio pesato per corriere nel 1997 (peso = freight) e quota di spedizioni in ritardo (%)."},{"role":"assistant","content":"WITH base AS ( SELECT s.shipperId, s.companyName, DATEDIFF(so.shippedDate, so.requiredDate) AS delay_days, CASE WHEN DATEDIFF(so.shippedDate, so.requiredDate) > 0 THEN 1 ELSE 0 END AS is_late, so.freight FROM SalesOrder so JOIN Shipper s ON s.shipperId = so.shipperid WHERE YEAR(so.orderDate) = 1997 AND so.shippedDate IS NOT NULL ), agg AS ( SELECT shipperId, companyName, COUNT(*) AS shipments, 100 * AVG(is_late) AS pct_late, SUM(delay_days * freight) / NULLIF(SUM(freight), 0) AS avg_delay_wt FROM base GROUP BY shipperId, companyName ) SELECT companyName, shipments, pct_late, avg_delay_wt FROM agg ORDER BY avg_delay_wt DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Quota di ricavo per prodotto all'interno della categoria nel 1997 (percentuale sul totale categoria)."},{"role":"assistant","content":"WITH prod AS ( SELECT c.categoryId, c.categoryName, p.productId, p.productName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Product p ON p.productId = od.productId JOIN Category c ON c.categoryId = p.categoryId WHERE YEAR(so.orderDate) = 1997 GROUP BY c.categoryId, c.categoryName, p.productId, p.productName ), shares AS ( SELECT categoryId, categoryName, productId, productName, revenue, revenue / NULLIF(SUM(revenue) OVER (PARTITION BY categoryId), 0) AS share FROM prod ) SELECT categoryId, categoryName, productId, productName, ROUND(100 * share, 2) AS pct_share FROM shares ORDER BY categoryId, pct_share DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Rapporto ordini per cliente 1997/1996 (YoY), con percentuale di crescita e filtro su clienti con almeno 10 ordini nel 1997."},{"role":"assistant","content":"WITH base AS ( SELECT so.custId, YEAR(so.orderDate) AS y, COUNT(DISTINCT so.orderId) AS orders FROM SalesOrder so WHERE YEAR(so.orderDate) IN (1996,1997) GROUP BY so.custId, YEAR(so.orderDate) ), y96 AS ( SELECT custId, orders AS o96 FROM base WHERE y = 1996 ), y97 AS ( SELECT custId, orders AS o97 FROM base WHERE y = 1997 ) SELECT cu.custId, cu.companyName, y97.o97 AS orders_1997, y96.o96 AS orders_1996, (y97.o97 - y96.o96) AS abs_growth, CASE WHEN y96.o96 > 0 THEN ROUND(100 * (y97.o97 - y96.o96) / y96.o96, 2) ELSE NULL END AS pct_growth FROM y97 LEFT JOIN y96 ON y96.custId = y97.custId JOIN Customer cu ON cu.custId = y97.custId WHERE y97.o97 >= 10 ORDER BY pct_growth DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Media mobile a 7 giorni del ricavo giornaliero nel Q4 1997 e percentuale del giorno sul cumulato fino a quel giorno."},{"role":"assistant","content":"WITH daily AS ( SELECT DATE(so.orderDate) AS day, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS rev FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE so.orderDate >= '1997-10-01' AND so.orderDate <= '1997-12-31' GROUP BY DATE(so.orderDate) ) SELECT d.day, d.rev, SUM(d.rev) OVER (ORDER BY d.day) AS cum_rev, AVG(d.rev) OVER (ORDER BY d.day ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS ma7, ROUND(100 * d.rev / NULLIF(SUM(d.rev) OVER (ORDER BY d.day), 0), 2) AS pct_of_cum FROM daily d ORDER BY d.day;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Delta YoY del ricavo per regione tra anni consecutivi (tutti gli anni disponibili)."},{"role":"assistant","content":"WITH rev AS ( SELECT YEAR(so.orderDate) AS y, r.regionId, r.regiondescription, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Employee e ON e.employeeId = so.employeeId JOIN EmployeeTerritory et ON et.employeeId = e.employeeId JOIN Territory t ON t.territoryId = et.territoryId JOIN Region r ON r.regionId = t.regionId GROUP BY YEAR(so.orderDate), r.regionId, r.regiondescription ), paired AS ( SELECT r2.regionId, r2.regiondescription, r2.y AS year, r1.revenue AS rev_prev, r2.revenue AS rev_curr FROM rev r2 JOIN rev r1 ON r1.regionId = r2.regionId AND r1.y = r2.y - 1 ) SELECT regionId, regiondescription, year, rev_prev, rev_curr, (rev_curr - rev_prev) AS delta, CASE WHEN rev_prev > 0 THEN ROUND(100*(rev_curr - rev_prev)/rev_prev,2) ELSE NULL END AS pct FROM paired ORDER BY year DESC, delta DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Ranking per regione dei corrieri per ritardo medio (tutti gli anni)."},{"role":"assistant","content":"WITH base AS ( SELECT r.regionId, r.regiondescription, s.shipperId, s.companyName, DATEDIFF(so.shippedDate, so.requiredDate) AS delay_days FROM SalesOrder so JOIN Shipper s ON s.shipperId = so.shipperid JOIN Employee e ON e.employeeId = so.employeeId JOIN EmployeeTerritory et ON et.employeeId = e.employeeId JOIN Territory t ON t.territoryId = et.territoryId JOIN Region r ON r.regionId = t.regionId WHERE so.shippedDate IS NOT NULL ), agg AS ( SELECT regionId, regiondescription, shipperId, companyName, AVG(delay_days) AS avg_delay FROM base GROUP BY regionId, regiondescription, shipperId, companyName ) SELECT regionId, regiondescription, shipperId, companyName, avg_delay, RANK() OVER (PARTITION BY regionId ORDER BY avg_delay DESC) AS rnk FROM agg ORDER BY regionId, rnk;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Quota di ricavo per categoria all'interno di ciascuna regione (tutti gli anni)."},{"role":"assistant","content":"WITH cat_reg AS ( SELECT r.regionId, r.regiondescription, c.categoryId, c.categoryName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Product p ON p.productId = od.productId JOIN Category c ON c.categoryId = p.categoryId JOIN Employee e ON e.employeeId = so.employeeId JOIN EmployeeTerritory et ON et.employeeId = e.employeeId JOIN Territory t ON t.territoryId = et.territoryId JOIN Region r ON r.regionId = t.regionId GROUP BY r.regionId, r.regiondescription, c.categoryId, c.categoryName ), shares AS ( SELECT regionId, regiondescription, categoryId, categoryName, revenue, revenue / NULLIF(SUM(revenue) OVER (PARTITION BY regionId), 0) AS share FROM cat_reg ) SELECT regionId, regiondescription, categoryId, categoryName, ROUND(100*share,2) AS pct_share FROM shares ORDER BY regionId, pct_share DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Ricavo YoY per regione con confronto tra corrieri (tutti gli anni)."},{"role":"assistant","content":"WITH rev AS ( SELECT YEAR(so.orderDate) AS y, r.regionId, r.regiondescription, s.shipperId, s.companyName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Shipper s ON s.shipperId = so.shipperid JOIN Employee e ON e.employeeId = so.employeeId JOIN EmployeeTerritory et ON et.employeeId = e.employeeId JOIN Territory t ON t.territoryId = et.territoryId JOIN Region r ON r.regionId = t.regionId GROUP BY YEAR(so.orderDate), r.regionId, r.regiondescription, s.shipperId, s.companyName ), paired AS ( SELECT r2.regionId, r2.regiondescription, r2.companyName, r2.y AS year, r1.revenue AS rev_prev, r2.revenue AS rev_curr FROM rev r2 JOIN rev r1 ON r1.regionId = r2.regionId AND r1.companyName = r2.companyName AND r1.y = r2.y - 1 ) SELECT regionId, regiondescription, companyName, year, rev_prev, rev_curr, (rev_curr - rev_prev) AS delta, CASE WHEN rev_prev > 0 THEN ROUND(100*(rev_curr - rev_prev)/rev_prev,2) ELSE NULL END AS pct FROM paired ORDER BY year DESC, delta DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Per regione, top 2 prodotti per quota di ricavo (percentuale sul totale regione), tutti gli anni."},{"role":"assistant","content":"WITH prod_reg AS ( SELECT r.regionId, r.regiondescription, p.productId, p.productName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Product p ON p.productId = od.productId JOIN Employee e ON e.employeeId = so.employeeId JOIN EmployeeTerritory et ON et.employeeId = e.employeeId JOIN Territory t ON t.territoryId = et.territoryId JOIN Region r ON r.regionId = t.regionId GROUP BY r.regionId, r.regiondescription, p.productId, p.productName ), shares AS ( SELECT regionId, regiondescription, productId, productName, revenue, revenue / NULLIF(SUM(revenue) OVER (PARTITION BY regionId), 0) AS share FROM prod_reg ), ranked AS ( SELECT regionId, regiondescription, productId, productName, share, ROW_NUMBER() OVER (PARTITION BY regionId ORDER BY share DESC) AS rn FROM shares ) SELECT regionId, regiondescription, productId, productName, ROUND(100*share,2) AS pct_share FROM ranked WHERE rn <= 2 ORDER BY regionId, pct_share DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Mediana del valore ordine per cliente nel 1997, ordinata decrescente."},{"role":"assistant","content":"WITH ords AS ( SELECT so.custId, od.orderId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY so.custId, od.orderId ), ranked AS ( SELECT custId, revenue, ROW_NUMBER() OVER (PARTITION BY custId ORDER BY revenue) AS rn, COUNT(*) OVER (PARTITION BY custId) AS cnt FROM ords ) SELECT cu.custId, cu.companyName, AVG(revenue) AS median_rev FROM ranked r JOIN Customer cu ON cu.custId = r.custId WHERE r.rn IN (FLOOR((r.cnt+1)/2), CEIL((r.cnt+1)/2)) GROUP BY cu.custId, cu.companyName ORDER BY median_rev DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"p75 del ritardo di spedizione per corriere nel 1997 (min 20 spedizioni)."},{"role":"assistant","content":"WITH base AS ( SELECT s.shipperId, s.companyName, DATEDIFF(so.shippedDate, so.requiredDate) AS delay_days FROM SalesOrder so JOIN Shipper s ON s.shipperId = so.shipperid WHERE YEAR(so.orderDate) = 1997 AND so.shippedDate IS NOT NULL ), ranked AS ( SELECT shipperId, companyName, delay_days, ROW_NUMBER() OVER (PARTITION BY shipperId ORDER BY delay_days) AS rn, COUNT(*) OVER (PARTITION BY shipperId) AS cnt FROM base ) SELECT companyName, AVG(delay_days) AS p75_delay FROM ranked WHERE rn BETWEEN CEIL(0.75*cnt) AND CEIL(0.75*cnt)+1 GROUP BY companyName HAVING COUNT(*) >= 20 ORDER BY p75_delay DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"p90 del ricavo ordine per categoria nel 1997 (per ordine)."},{"role":"assistant","content":"WITH ords AS ( SELECT c.categoryId, c.categoryName, od.orderId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM Category c JOIN Product p ON p.categoryId = c.categoryId JOIN OrderDetail od ON od.productId = p.productId JOIN SalesOrder so ON so.orderId = od.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY c.categoryId, c.categoryName, od.orderId ), ranked AS ( SELECT categoryId, categoryName, revenue, ROW_NUMBER() OVER (PARTITION BY categoryId ORDER BY revenue) AS rn, COUNT(*) OVER (PARTITION BY categoryId) AS cnt FROM ords ) SELECT categoryId, categoryName, AVG(revenue) AS p90_revenue FROM ranked WHERE rn BETWEEN CEIL(0.9*cnt) AND CEIL(0.9*cnt)+1 GROUP BY categoryId, categoryName ORDER BY p90_revenue DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Mediana del ritardo per area (shipRegion o shipCountry) nel 1997."},{"role":"assistant","content":"WITH base AS ( SELECT COALESCE(so.shipRegion, so.shipCountry) AS loc, DATEDIFF(so.shippedDate, so.requiredDate) AS delay_days FROM SalesOrder so WHERE YEAR(so.orderDate) = 1997 AND so.shippedDate IS NOT NULL ), ranked AS ( SELECT loc, delay_days, ROW_NUMBER() OVER (PARTITION BY loc ORDER BY delay_days) AS rn, COUNT(*) OVER (PARTITION BY loc) AS cnt FROM base ) SELECT loc, AVG(delay_days) AS median_delay FROM ranked WHERE rn IN (FLOOR((cnt+1)/2), CEIL((cnt+1)/2)) GROUP BY loc ORDER BY median_delay DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"p50/p75/p90 del ricavo per cliente nel 1997 (per ordine), con tutti e tre i valori."},{"role":"assistant","content":"WITH ords AS ( SELECT so.custId, od.orderId, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY so.custId, od.orderId ), ranked AS ( SELECT custId, revenue, ROW_NUMBER() OVER (PARTITION BY custId ORDER BY revenue) AS rn, COUNT(*) OVER (PARTITION BY custId) AS cnt FROM ords ), pcts AS ( SELECT custId, AVG(CASE WHEN rn IN (FLOOR((cnt+1)/2), CEIL((cnt+1)/2)) THEN revenue END) AS p50, AVG(CASE WHEN rn BETWEEN CEIL(0.75*cnt) AND CEIL(0.75*cnt)+1 THEN revenue END) AS p75, AVG(CASE WHEN rn BETWEEN CEIL(0.9*cnt) AND CEIL(0.9*cnt)+1 THEN revenue END) AS p90 FROM ranked GROUP BY custId ) SELECT cu.custId, cu.companyName, p.p50, p.p75, p.p90 FROM pcts p JOIN Customer cu ON cu.custId = p.custId ORDER BY p.p90 DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Ricavo e numero ordini per categoria e mese nel 1997 (YYYY-MM), rispettando ONLY_FULL_GROUP_BY."},{"role":"assistant","content":"SELECT DATE_FORMAT(so.orderDate,'%Y-%m') AS ym, c.categoryId, c.categoryName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue, COUNT(DISTINCT so.orderId) AS orders FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Product p ON p.productId = od.productId JOIN Category c ON c.categoryId = p.categoryId WHERE YEAR(so.orderDate) = 1997 GROUP BY DATE_FORMAT(so.orderDate,'%Y-%m'), c.categoryId, c.categoryName ORDER BY ym, c.categoryId;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Top 3 città per ricavo per categoria nel 1997 (aggregazione per categoria, città)."},{"role":"assistant","content":"WITH cat_city AS ( SELECT c.categoryId, c.categoryName, so.shipCity, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Product p ON p.productId = od.productId JOIN Category c ON c.categoryId = p.categoryId WHERE YEAR(so.orderDate) = 1997 GROUP BY c.categoryId, c.categoryName, so.shipCity ), ranked AS ( SELECT categoryId, categoryName, shipCity, revenue, ROW_NUMBER() OVER (PARTITION BY categoryId ORDER BY revenue DESC) AS rn FROM cat_city ) SELECT categoryId, categoryName, shipCity, revenue FROM ranked WHERE rn <= 3 ORDER BY categoryId, revenue DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Ricavo e ordini per fornitore e paese di spedizione nel 1997."},{"role":"assistant","content":"SELECT s.supplierId, s.companyName, COALESCE(so.shipRegion, so.shipCountry) AS loc, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue, COUNT(DISTINCT so.orderId) AS orders FROM Supplier s JOIN Product p ON p.supplierId = s.supplierId JOIN OrderDetail od ON od.productId = p.productId JOIN SalesOrder so ON so.orderId = od.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY s.supplierId, s.companyName, COALESCE(so.shipRegion, so.shipCountry) ORDER BY s.supplierId, revenue DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Quota di ricavo per categoria e regione nel 1997 (percentuale entro categoria)."},{"role":"assistant","content":"WITH cat_reg AS ( SELECT c.categoryId, c.categoryName, COALESCE(so.shipRegion, so.shipCountry) AS loc, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId JOIN Product p ON p.productId = od.productId JOIN Category c ON c.categoryId = p.categoryId WHERE YEAR(so.orderDate) = 1997 GROUP BY c.categoryId, c.categoryName, COALESCE(so.shipRegion, so.shipCountry) ), shares AS ( SELECT categoryId, categoryName, loc, revenue, revenue / NULLIF(SUM(revenue) OVER (PARTITION BY categoryId), 0) AS share FROM cat_reg ) SELECT categoryId, categoryName, loc, ROUND(100*share,2) AS pct_share FROM shares ORDER BY categoryId, pct_share DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Ricavo mensile per regione nel 1997, con numero ordini e freight medio per regione e mese."},{"role":"assistant","content":"SELECT DATE_FORMAT(so.orderDate,'%Y-%m') AS ym, COALESCE(so.shipRegion, so.shipCountry) AS loc, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue, COUNT(DISTINCT so.orderId) AS orders, AVG(so.freight) AS avg_freight FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE YEAR(so.orderDate) = 1997 GROUP BY DATE_FORMAT(so.orderDate,'%Y-%m'), COALESCE(so.shipRegion, so.shipCountry) ORDER BY ym, loc;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Delta giornaliero del ricavo (giorno su giorno) nel Q4 1997 usando LAG."},{"role":"assistant","content":"WITH daily AS ( SELECT DATE(so.orderDate) AS day, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS rev FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId WHERE so.orderDate >= '1997-10-01' AND so.orderDate <= '1997-12-31' GROUP BY DATE(so.orderDate) ) SELECT d.day, d.rev, (d.rev - LAG(d.rev) OVER (ORDER BY d.day)) AS delta_rev FROM daily d ORDER BY d.day;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Top prodotti per ricavo con DENSE_RANK per gestire ex aequo (limita a rank <= 3)."},{"role":"assistant","content":"WITH prod_rev AS ( SELECT p.productId, p.productName, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS revenue FROM Product p JOIN OrderDetail od ON od.productId = p.productId JOIN SalesOrder so ON so.orderId = od.orderId GROUP BY p.productId, p.productName ) SELECT productId, productName, revenue, DENSE_RANK() OVER (ORDER BY revenue DESC) AS rnk FROM prod_rev WHERE DENSE_RANK() OVER (ORDER BY revenue DESC) <= 3 ORDER BY rnk, revenue DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Tempo in giorni tra ordine e spedizione per ogni ordine (TIMESTAMPDIFF), con media per cliente."},{"role":"assistant","content":"WITH ord_delay AS ( SELECT so.orderId, so.custId, TIMESTAMPDIFF(DAY, so.orderDate, so.shippedDate) AS days_to_ship FROM SalesOrder so WHERE so.shippedDate IS NOT NULL ) SELECT cu.custId, cu.companyName, AVG(od.days_to_ship) AS avg_days_to_ship FROM ord_delay od JOIN Customer cu ON cu.custId = od.custId GROUP BY cu.custId, cu.companyName ORDER BY avg_days_to_ship DESC;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Quota di ricavo giornaliera sul cumulato fino a quel giorno senza riusare alias in OVER nella stessa SELECT (usa CTE)."},{"role":"assistant","content":"WITH daily AS ( SELECT DATE(so.orderDate) AS day, SUM(od.quantity*od.unitPrice*(1-COALESCE(od.discount,0))) AS rev FROM SalesOrder so JOIN OrderDetail od ON od.orderId = so.orderId GROUP BY DATE(so.orderDate) ), cum AS ( SELECT d.day, d.rev, SUM(d.rev) OVER (ORDER BY d.day) AS cum_rev FROM daily d ) SELECT c.day, c.rev, c.cum_rev, ROUND(100 * c.rev / NULLIF(c.cum_rev, 0), 2) AS pct_of_cum FROM cum c ORDER BY c.day;"}]}
{"messages":[{"role":"system","content":"Sei un assistente SQL esperto per il database Northwind su MySQL 8.  \nRegole: una sola query SELECT, nessuna spiegazione, usa solo tabelle/colonne esistenti, chiudi con ';'.\n"},{"role":"user","content":"Evita subquery scalari: calcola per corriere spedizioni totali e ritardo medio (giorni) usando CTE e join, senza subquery scalari nel SELECT."},{"role":"assistant","content":"WITH ship_base AS ( SELECT s.shipperId, s.companyName, DATEDIFF(so.shippedDate, so.requiredDate) AS delay_days FROM SalesOrder so JOIN Shipper s ON s.shipperId = so.shipperid WHERE so.shippedDate IS NOT NULL ), ship_agg AS ( SELECT shipperId, companyName, COUNT(*) AS shipments, AVG(delay_days) AS avg_delay FROM ship_base GROUP BY shipperId, companyName ) SELECT shipperId, companyName, shipments, avg_delay FROM ship_agg ORDER BY avg_delay DESC;"}]}
